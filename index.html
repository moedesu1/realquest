<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>リアクエ REAL QUEST — 日常が、クエストになる</title>
<meta name="description" content="リアクエ（REAL QUEST）は日常をクエストに変える体験型アドベンチャーサービス。自宅に届くリアルアイテムで、あなただけの冒険が始まる。">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DotGothic16&family=Noto+Sans+JP:wght@300;400;500;700;900&family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
/* ============================================================
   REAL QUEST — DESIGN SYSTEM
   ============================================================ */
:root {
  --bg-abyss: #050508;
  --bg-deep: #0a0a12;
  --bg-panel: #0d0d1a;
  --bg-card: #111125;
  --bg-card-hover: #161638;
  --border-dim: #1a1a3a;
  --border-glow: #2a2a5a;
  --text-primary: #e8e6f0;
  --text-secondary: #b8b6c8;
  --text-dim: #7a7890;
  --neon-cyan: #00f0ff;
  --neon-cyan-dim: #00889940;
  --neon-magenta: #ff00aa;
  --neon-magenta-dim: #ff00aa30;
  --neon-gold: #ffd700;
  --neon-gold-dim: #ffd70030;
  --neon-green: #00ff88;
  --neon-red: #ff3355;
  --neon-purple: #aa66ff;
  --pixel-font: 'DotGothic16', 'Press Start 2P', monospace;
  --body-font: 'Noto Sans JP', sans-serif;
  --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
  --ease-in-out: cubic-bezier(0.76, 0, 0.24, 1);
}

/* ============================================================
   RESET & BASE
   ============================================================ */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

html {
  font-size: 16px;
  scroll-behavior: smooth;
  -webkit-font-smoothing: antialiased;
}

body {
  font-family: var(--body-font);
  background: var(--bg-abyss);
  color: var(--text-primary);
  overflow-x: hidden;
  min-height: 100vh;
}

a { color: inherit; text-decoration: none; }
button { font-family: inherit; cursor: pointer; border: none; background: none; }
img { max-width: 100%; display: block; }

/* scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg-abyss); }
::-webkit-scrollbar-thumb { background: var(--border-glow); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--neon-cyan); }

/* ============================================================
   SHARED UTILITIES
   ============================================================ */
.pixel-text { font-family: var(--pixel-font); }
.neon-text-cyan { color: var(--neon-cyan); text-shadow: 0 0 10px var(--neon-cyan), 0 0 40px var(--neon-cyan-dim); }
.neon-text-gold { color: var(--neon-gold); text-shadow: 0 0 10px var(--neon-gold), 0 0 40px var(--neon-gold-dim); }
.neon-text-magenta { color: var(--neon-magenta); text-shadow: 0 0 10px var(--neon-magenta), 0 0 40px var(--neon-magenta-dim); }

/* ============================================================
   PAGE SYSTEM
   ============================================================ */
.page {
  position: fixed;
  inset: 0;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.8s var(--ease-in-out);
  overflow-y: auto;
  overflow-x: hidden;
  z-index: 1;
}
.page.active {
  opacity: 1;
  pointer-events: auto;
  z-index: 10;
}

/* ============================================================
   SCANLINE OVERLAY (Global)
   ============================================================ */
.scanlines {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 9999;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0,0,0,0.06) 2px,
    rgba(0,0,0,0.06) 4px
  );
  mix-blend-mode: overlay;
}

/* ============================================================
   PARTICLE CANVAS
   ============================================================ */
#particle-canvas {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}

/* ============================================================
   PAGE 1 — OPENING / FIRST VIEW
   ============================================================ */
#page-opening {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: var(--bg-abyss);
  z-index: 10;
}

/* vignette */
#page-opening::before {
  content: '';
  position: fixed;
  inset: 0;
  background: radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.7) 100%);
  pointer-events: none;
  z-index: 1;
}

/* grid floor effect */
#page-opening::after {
  content: '';
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 40vh;
  background:
    linear-gradient(to top, rgba(0,240,255,0.03) 0%, transparent 100%),
    repeating-linear-gradient(90deg, transparent, transparent 59px, rgba(0,240,255,0.04) 59px, rgba(0,240,255,0.04) 60px),
    repeating-linear-gradient(0deg, transparent, transparent 59px, rgba(0,240,255,0.04) 59px, rgba(0,240,255,0.04) 60px);
  mask-image: linear-gradient(to top, rgba(0,0,0,0.6) 0%, transparent 100%);
  -webkit-mask-image: linear-gradient(to top, rgba(0,0,0,0.6) 0%, transparent 100%);
  pointer-events: none;
  z-index: 0;
  perspective: 400px;
  transform: rotateX(45deg);
  transform-origin: bottom center;
}

.opening-content {
  position: relative;
  z-index: 2;
  text-align: center;
  padding: 2rem;
}

/* logo treatment */
.logo-mark {
  margin-bottom: 1rem;
  opacity: 0;
  animation: logoReveal 2s var(--ease-out-expo) 0.5s forwards;
}

.logo-sub {
  font-family: var(--pixel-font);
  font-size: clamp(0.65rem, 1.5vw, 0.85rem);
  letter-spacing: 0.5em;
  color: var(--text-dim);
  text-transform: uppercase;
  margin-bottom: 0.5rem;
  opacity: 0;
  animation: fadeUp 1.5s var(--ease-out-expo) 0.8s forwards;
}

.logo-main {
  font-family: var(--pixel-font);
  font-size: clamp(2.2rem, 7vw, 4.5rem);
  color: var(--neon-cyan);
  text-shadow:
    0 0 20px rgba(0,240,255,0.6),
    0 0 60px rgba(0,240,255,0.3),
    0 0 120px rgba(0,240,255,0.1);
  letter-spacing: 0.08em;
  line-height: 1.2;
  margin-bottom: 0.3rem;
  opacity: 0;
  animation: logoTextReveal 2s var(--ease-out-expo) 1s forwards;
}

.logo-main-en {
  font-family: 'Press Start 2P', var(--pixel-font);
  font-size: clamp(0.6rem, 2vw, 1rem);
  color: var(--neon-cyan);
  text-shadow: 0 0 15px rgba(0,240,255,0.4);
  letter-spacing: 0.35em;
  opacity: 0;
  animation: fadeUp 1.5s var(--ease-out-expo) 1.3s forwards;
  margin-bottom: 2.5rem;
}

.logo-tagline {
  font-family: var(--body-font);
  font-weight: 300;
  font-size: clamp(0.9rem, 2.5vw, 1.3rem);
  color: var(--text-secondary);
  letter-spacing: 0.2em;
  margin-bottom: 3.5rem;
  opacity: 0;
  animation: fadeUp 1.5s var(--ease-out-expo) 1.6s forwards;
}

.logo-tagline span {
  color: var(--neon-gold);
  text-shadow: 0 0 10px var(--neon-gold-dim);
  font-weight: 500;
}

/* decorative sword divider */
.divider-sword {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 1rem;
  margin-bottom: 2.5rem;
  opacity: 0;
  animation: fadeUp 1.5s var(--ease-out-expo) 1.4s forwards;
}
.divider-sword .line {
  width: clamp(40px, 10vw, 80px);
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--neon-cyan), transparent);
}
.divider-sword .diamond {
  width: 8px;
  height: 8px;
  background: var(--neon-cyan);
  transform: rotate(45deg);
  box-shadow: 0 0 8px var(--neon-cyan);
}

/* CTA button */
.btn-start {
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 0.8rem;
  padding: 1rem 2.5rem;
  font-family: var(--pixel-font);
  font-size: clamp(0.85rem, 2vw, 1.1rem);
  color: var(--bg-abyss);
  background: var(--neon-cyan);
  border: 2px solid var(--neon-cyan);
  clip-path: polygon(8px 0%, 100% 0%, calc(100% - 8px) 100%, 0% 100%);
  transition: all 0.3s ease;
  opacity: 0;
  animation: fadeUp 1.5s var(--ease-out-expo) 4.2s forwards;
  overflow: hidden;
}

.btn-start::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  transform: translateX(-100%);
  animation: shimmer 3s ease-in-out 3s infinite;
}

.btn-start:hover {
  background: transparent;
  color: var(--neon-cyan);
  box-shadow: 0 0 30px var(--neon-cyan-dim), inset 0 0 30px var(--neon-cyan-dim);
  transform: scale(1.05);
}

.btn-start .play-icon {
  font-size: 1.2em;
}

/* corner frames */
.corner-frame {
  position: fixed;
  width: 60px;
  height: 60px;
  border-color: var(--neon-cyan);
  border-style: solid;
  border-width: 0;
  opacity: 0;
  z-index: 3;
  animation: cornerReveal 1.5s var(--ease-out-expo) 2.5s forwards;
}
.corner-frame.tl { top: 20px; left: 20px; border-top-width: 2px; border-left-width: 2px; }
.corner-frame.tr { top: 20px; right: 20px; border-top-width: 2px; border-right-width: 2px; }
.corner-frame.bl { bottom: 20px; left: 20px; border-bottom-width: 2px; border-left-width: 2px; }
.corner-frame.br { bottom: 20px; right: 20px; border-bottom-width: 2px; border-right-width: 2px; }

/* bottom hint */
.scroll-hint {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  font-family: var(--pixel-font);
  font-size: 0.6rem;
  color: var(--text-dim);
  letter-spacing: 0.2em;
  z-index: 3;
  opacity: 0;
  animation: fadeUp 1.5s var(--ease-out-expo) 5s forwards, pulse 2s ease-in-out 6s infinite;
}

/* ============================================================
   TRANSITION OVERLAY
   ============================================================ */
.transition-overlay {
  position: fixed;
  inset: 0;
  z-index: 100;
  background: var(--bg-abyss);
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
}
.transition-overlay.active {
  opacity: 1;
  pointer-events: auto;
}
.transition-text {
  font-family: var(--pixel-font);
  font-size: clamp(0.8rem, 2vw, 1.2rem);
  color: var(--neon-cyan);
  text-shadow: 0 0 20px var(--neon-cyan);
  animation: blink 0.8s steps(2) infinite;
}

/* ============================================================
   PAGE 2 — QUEST BOARD
   ============================================================ */
#page-quest-board {
  background: var(--bg-abyss);
  padding-bottom: 4rem;
}

/* top bar */
.quest-board-header {
  position: sticky;
  top: 0;
  z-index: 50;
  background: rgba(5,5,8,0.92);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border-dim);
  padding: 0.8rem 1.5rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.header-logo {
  font-family: var(--pixel-font);
  font-size: 0.9rem;
  color: var(--neon-cyan);
  text-shadow: 0 0 8px var(--neon-cyan-dim);
}

.header-nav {
  display: flex;
  align-items: center;
  gap: 0.6rem;
}

.nav-pill {
  font-family: var(--pixel-font);
  font-size: 0.65rem;
  color: var(--text-dim);
  padding: 0.4rem 0.8rem;
  border: 1px solid var(--border-dim);
  transition: all 0.3s ease;
}
.nav-pill:hover, .nav-pill.active {
  color: var(--neon-cyan);
  border-color: var(--neon-cyan);
  box-shadow: 0 0 10px var(--neon-cyan-dim);
}

/* audio control */
.audio-toggle {
  font-family: var(--pixel-font);
  font-size: 0.7rem;
  color: var(--neon-gold);
  padding: 0.3rem 0.6rem;
  border: 1px solid var(--neon-gold-dim);
  border-radius: 2px;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 0.3rem;
}
.audio-toggle:hover {
  box-shadow: 0 0 10px var(--neon-gold-dim);
}
.audio-bars {
  display: flex;
  gap: 2px;
  align-items: flex-end;
  height: 10px;
}
.audio-bars span {
  width: 2px;
  background: var(--neon-gold);
  animation: audioBar 0.8s ease-in-out infinite alternate;
}
.audio-bars span:nth-child(1) { height: 3px; animation-delay: 0s; }
.audio-bars span:nth-child(2) { height: 7px; animation-delay: 0.2s; }
.audio-bars span:nth-child(3) { height: 5px; animation-delay: 0.4s; }
.audio-bars span:nth-child(4) { height: 9px; animation-delay: 0.1s; }
.audio-toggle.muted .audio-bars span { animation: none; height: 2px; }

/* board title area */
.board-title-area {
  text-align: center;
  padding: 3rem 1.5rem 1rem;
}

.board-label {
  font-family: var(--pixel-font);
  font-size: 0.7rem;
  letter-spacing: 0.4em;
  color: var(--neon-gold);
  text-shadow: 0 0 8px var(--neon-gold-dim);
  margin-bottom: 0.8rem;
}

.board-title {
  font-family: var(--pixel-font);
  font-size: clamp(1.2rem, 4vw, 2rem);
  color: var(--text-primary);
  margin-bottom: 0.5rem;
}

.board-subtitle {
  font-size: 0.9rem;
  color: var(--text-secondary);
  font-weight: 300;
}

.board-divider {
  width: 80%;
  max-width: 600px;
  margin: 1.5rem auto 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--border-glow), transparent);
}

/* filter bar */
.filter-bar {
  display: flex;
  justify-content: center;
  gap: 0.5rem;
  padding: 1.5rem 1rem;
  flex-wrap: wrap;
}

.filter-chip {
  font-family: var(--pixel-font);
  font-size: 0.65rem;
  color: var(--text-dim);
  padding: 0.4rem 1rem;
  border: 1px solid var(--border-dim);
  transition: all 0.3s ease;
  cursor: pointer;
}
.filter-chip:hover, .filter-chip.active {
  color: var(--neon-cyan);
  border-color: var(--neon-cyan);
  background: rgba(0,240,255,0.05);
  box-shadow: 0 0 10px var(--neon-cyan-dim);
}

/* quest grid */
.quest-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.2rem;
  padding: 0 1.5rem;
  max-width: 1200px;
  margin: 0 auto;
}

@media (max-width: 700px) {
  .quest-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 0.8rem;
    padding: 0 0.8rem;
  }
}

@media (max-width: 420px) {
  .quest-grid {
    grid-template-columns: 1fr;
  }
}

/* card image */
.card-image {
  position: relative;
  width: 100%;
  aspect-ratio: 16 / 9;
  margin: -1.2rem -1.2rem 1rem -1.2rem;
  width: calc(100% + 2.4rem);
  overflow: hidden;
  border-bottom: 1px solid var(--border-dim);
}
.card-image svg {
  width: 100%;
  height: 100%;
  display: block;
}
.card-image::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 40%;
  background: linear-gradient(to top, var(--bg-card), transparent);
  pointer-events: none;
}

/* detail hero image */
.detail-hero {
  width: 100%;
  aspect-ratio: 21 / 9;
  overflow: hidden;
  margin-bottom: 1.5rem;
  border: 1px solid var(--border-dim);
  position: relative;
}
.detail-hero svg {
  width: 100%;
  height: 100%;
  display: block;
}
.detail-hero::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 50%;
  background: linear-gradient(to top, var(--bg-abyss), transparent);
  pointer-events: none;
}

/* quest card */
.quest-card {
  position: relative;
  background: var(--bg-card);
  border: 1px solid var(--border-dim);
  padding: 1.2rem;
  cursor: pointer;
  transition: all 0.4s var(--ease-out-expo);
  overflow: hidden;
}

.quest-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, var(--neon-cyan), var(--neon-magenta));
  opacity: 0;
  transition: opacity 0.3s ease;
}

.quest-card::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, transparent 60%, rgba(0,240,255,0.03));
  pointer-events: none;
}

.quest-card:hover {
  border-color: var(--neon-cyan);
  background: var(--bg-card-hover);
  transform: translateY(-4px);
  box-shadow: 0 8px 32px rgba(0,240,255,0.08), 0 0 0 1px rgba(0,240,255,0.1);
}

.quest-card:hover::before {
  opacity: 1;
}

/* card inner elements */
.card-rank {
  display: inline-block;
  font-family: var(--pixel-font);
  font-size: 0.6rem;
  padding: 0.25rem 0.6rem;
  margin-bottom: 0.8rem;
  border: 1px solid;
}
.rank-S { color: var(--neon-gold); border-color: var(--neon-gold); background: rgba(255,215,0,0.08); }
.rank-A { color: var(--neon-magenta); border-color: var(--neon-magenta); background: rgba(255,0,170,0.08); }
.rank-B { color: var(--neon-cyan); border-color: var(--neon-cyan); background: rgba(0,240,255,0.08); }
.rank-C { color: var(--neon-green); border-color: var(--neon-green); background: rgba(0,255,136,0.08); }
.rank-D { color: var(--text-secondary); border-color: var(--text-secondary); background: rgba(152,150,168,0.08); }

.card-title {
  font-family: var(--pixel-font);
  font-size: clamp(0.85rem, 2.2vw, 1.05rem);
  color: var(--text-primary);
  margin-bottom: 0.8rem;
  line-height: 1.6;
}

.card-meta {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
  margin-bottom: 1rem;
}

.meta-row {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.8rem;
}
.meta-label {
  font-family: var(--pixel-font);
  font-size: 0.6rem;
  color: var(--text-dim);
  min-width: 60px;
}
.meta-value {
  color: var(--text-secondary);
  font-size: 0.8rem;
}

.difficulty-stars {
  display: flex;
  gap: 2px;
}
.difficulty-stars .star {
  width: 12px;
  height: 12px;
  background: var(--neon-gold);
  clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
}
.difficulty-stars .star.empty {
  background: var(--border-dim);
}

.card-items {
  font-size: 0.78rem;
  color: var(--text-secondary);
  margin-bottom: 1rem;
  line-height: 1.7;
  border-left: 2px solid var(--border-dim);
  padding-left: 0.8rem;
}

.card-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-top: 1px solid var(--border-dim);
  padding-top: 0.8rem;
}

.card-price {
  font-family: var(--pixel-font);
  font-size: 1.1rem;
  color: var(--neon-gold);
  text-shadow: 0 0 8px var(--neon-gold-dim);
}
.card-price .currency {
  font-size: 0.7rem;
  color: var(--text-dim);
  margin-right: 2px;
}

.card-action {
  font-family: var(--pixel-font);
  font-size: 0.6rem;
  color: var(--neon-cyan);
  display: flex;
  align-items: center;
  gap: 0.3rem;
  opacity: 0;
  transform: translateX(-8px);
  transition: all 0.3s ease;
}
.quest-card:hover .card-action {
  opacity: 1;
  transform: translateX(0);
}

/* new badge */
.badge-new {
  position: absolute;
  top: 0;
  right: 0;
  font-family: var(--pixel-font);
  font-size: 0.55rem;
  color: var(--bg-abyss);
  background: var(--neon-magenta);
  padding: 0.25rem 0.6rem;
  z-index: 2;
  font-weight: 700;
}

/* ============================================================
   PAGE 3 — QUEST DETAIL
   ============================================================ */
#page-detail {
  background: var(--bg-abyss);
}

.detail-container {
  max-width: 760px;
  margin: 0 auto;
  padding: 0 1.5rem 4rem;
}

/* back nav */
.detail-back {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-family: var(--pixel-font);
  font-size: 0.7rem;
  color: var(--text-dim);
  padding: 1.2rem 0;
  transition: color 0.3s ease;
  cursor: pointer;
}
.detail-back:hover { color: var(--neon-cyan); }

/* detail header */
.detail-header {
  text-align: center;
  padding: 1rem 0 2rem;
  border-bottom: 1px solid var(--border-dim);
  margin-bottom: 2rem;
}

.detail-rank-badge {
  display: inline-block;
  font-family: var(--pixel-font);
  font-size: 0.7rem;
  padding: 0.3rem 0.8rem;
  margin-bottom: 1rem;
  border: 1px solid;
}

.detail-title {
  font-family: var(--pixel-font);
  font-size: clamp(1.1rem, 3.5vw, 1.6rem);
  color: var(--text-primary);
  line-height: 1.5;
  margin-bottom: 0.8rem;
}

.detail-tagline {
  font-size: 0.9rem;
  color: var(--text-secondary);
  font-weight: 300;
  font-style: italic;
}

/* status panel */
.status-panel {
  background: var(--bg-panel);
  border: 1px solid var(--border-dim);
  padding: 1.2rem;
  margin-bottom: 2rem;
}

.status-panel-title {
  font-family: var(--pixel-font);
  font-size: 0.7rem;
  color: var(--neon-cyan);
  text-shadow: 0 0 8px var(--neon-cyan-dim);
  margin-bottom: 1rem;
  letter-spacing: 0.1em;
}

.status-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.8rem;
}

@media (max-width: 500px) {
  .status-grid { grid-template-columns: 1fr; }
}

.stat-item {
  display: flex;
  align-items: center;
  gap: 0.8rem;
  padding: 0.5rem;
  background: rgba(0,0,0,0.3);
  border-left: 2px solid var(--border-glow);
}

.stat-icon {
  font-size: 1.2rem;
  width: 2rem;
  text-align: center;
}

.stat-info .stat-label {
  font-family: var(--pixel-font);
  font-size: 0.55rem;
  color: var(--text-dim);
  letter-spacing: 0.1em;
}
.stat-info .stat-value {
  font-size: 0.9rem;
  color: var(--text-primary);
  margin-top: 0.15rem;
}

/* prologue */
.section-block {
  margin-bottom: 2rem;
}

.section-title {
  font-family: var(--pixel-font);
  font-size: 0.8rem;
  color: var(--neon-gold);
  text-shadow: 0 0 8px var(--neon-gold-dim);
  margin-bottom: 1rem;
  letter-spacing: 0.1em;
  display: flex;
  align-items: center;
  gap: 0.6rem;
}
.section-title::after {
  content: '';
  flex: 1;
  height: 1px;
  background: linear-gradient(90deg, var(--neon-gold-dim), transparent);
}

.prologue-text {
  font-size: 0.95rem;
  line-height: 2;
  color: var(--text-primary);
  font-weight: 300;
  padding: 1rem;
  background: var(--bg-panel);
  border-left: 2px solid var(--neon-gold-dim);
}

/* items list */
.items-list {
  list-style: none;
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
}

.items-list li {
  display: flex;
  align-items: center;
  gap: 0.8rem;
  padding: 0.7rem 1rem;
  background: var(--bg-panel);
  border: 1px solid var(--border-dim);
  font-size: 0.9rem;
  color: var(--text-primary);
  transition: border-color 0.3s ease;
}
.items-list li:hover {
  border-color: var(--neon-cyan-dim);
}
.items-list .item-icon {
  font-size: 1.1rem;
}

/* purchase area */
.purchase-area {
  background: var(--bg-panel);
  border: 1px solid var(--border-glow);
  padding: 1.5rem;
  text-align: center;
  margin-top: 2rem;
}

.purchase-price {
  font-family: var(--pixel-font);
  font-size: clamp(1.5rem, 4vw, 2rem);
  color: var(--neon-gold);
  text-shadow: 0 0 15px var(--neon-gold-dim);
  margin-bottom: 0.3rem;
}
.purchase-price .tax {
  font-size: 0.65rem;
  color: var(--text-dim);
}

.purchase-shipping {
  font-size: 0.8rem;
  color: var(--text-dim);
  margin-bottom: 1.2rem;
}

.btn-purchase {
  display: inline-flex;
  align-items: center;
  gap: 0.6rem;
  padding: 1rem 2.5rem;
  font-family: var(--pixel-font);
  font-size: clamp(0.7rem, 2vw, 0.9rem);
  color: var(--bg-abyss);
  background: linear-gradient(135deg, var(--neon-gold), #ffaa00);
  border: 2px solid var(--neon-gold);
  clip-path: polygon(8px 0%, 100% 0%, calc(100% - 8px) 100%, 0% 100%);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.btn-purchase::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  transform: translateX(-100%);
  animation: shimmer 3s ease-in-out infinite;
}

.btn-purchase:hover {
  transform: scale(1.05);
  box-shadow: 0 0 30px var(--neon-gold-dim);
}

.purchase-note {
  font-size: 0.75rem;
  color: var(--text-dim);
  margin-top: 0.8rem;
}

/* ============================================================
   FOOTER
   ============================================================ */
.site-footer {
  border-top: 1px solid var(--border-dim);
  padding: 2rem 1.5rem;
  text-align: center;
}

.footer-logo {
  font-family: var(--pixel-font);
  font-size: 0.8rem;
  color: var(--neon-cyan);
  text-shadow: 0 0 8px var(--neon-cyan-dim);
  margin-bottom: 0.5rem;
}

.footer-text {
  font-size: 0.75rem;
  color: var(--text-dim);
}

/* ============================================================
   ANIMATIONS
   ============================================================ */
@keyframes logoReveal {
  from { opacity: 0; transform: scale(0.9); filter: blur(10px); }
  to { opacity: 1; transform: scale(1); filter: blur(0); }
}

@keyframes logoTextReveal {
  0% { opacity: 0; transform: translateY(20px); letter-spacing: 0.3em; }
  100% { opacity: 1; transform: translateY(0); letter-spacing: 0.08em; }
}

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(15px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes cornerReveal {
  from { opacity: 0; }
  to { opacity: 0.3; }
}

@keyframes shimmer {
  0% { transform: translateX(-100%); }
  60%, 100% { transform: translateX(100%); }
}

@keyframes pulse {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 1; }
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0; }
}

@keyframes audioBar {
  0% { height: 2px; }
  100% { height: 10px; }
}

@keyframes cardReveal {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

/* card entrance */
.quest-card {
  opacity: 0;
  animation: cardReveal 0.6s var(--ease-out-expo) forwards;
}
.quest-card:nth-child(1) { animation-delay: 0.1s; }
.quest-card:nth-child(2) { animation-delay: 0.2s; }
.quest-card:nth-child(3) { animation-delay: 0.3s; }
.quest-card:nth-child(4) { animation-delay: 0.4s; }
.quest-card:nth-child(5) { animation-delay: 0.5s; }
.quest-card:nth-child(6) { animation-delay: 0.6s; }

/* ============================================================
   RESPONSIVE
   ============================================================ */
@media (max-width: 600px) {
  .corner-frame { width: 30px; height: 30px; }
  .quest-board-header { padding: 0.6rem 0.8rem; }
  .header-logo { font-size: 0.7rem; }
  .board-title-area { padding: 2rem 1rem 0.8rem; }
  .detail-container { padding: 0 1rem 3rem; }
  .status-panel { padding: 0.8rem; }
  .purchase-area { padding: 1rem; }
  .guild-master-area { padding: 1.5rem 1rem; }
  .guild-master-area .gm-line { font-size: 0.85rem; }
}

/* ============================================================
   NARRATION LINES (First View)
   ============================================================ */
.narration-area {
  margin-bottom: 2.5rem;
  opacity: 0;
  animation: fadeUp 1s var(--ease-out-expo) 1.7s forwards;
}
.narration-line {
  font-family: var(--body-font);
  font-size: clamp(0.85rem, 2.2vw, 1.05rem);
  color: var(--text-secondary);
  line-height: 2.2;
  letter-spacing: 0.08em;
  font-weight: 300;
  opacity: 0;
  transform: translateY(8px);
  animation: narratFadeIn 1.2s var(--ease-out-expo) forwards;
}
.narration-line:nth-child(1) { animation-delay: 1.8s; }
.narration-line:nth-child(2) { animation-delay: 2.6s; }
.narration-line:nth-child(3) { animation-delay: 3.4s; color: var(--neon-gold); text-shadow: 0 0 12px var(--neon-gold-dim); font-weight: 400; }

@keyframes narratFadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* ============================================================
   GUILD MASTER AREA (Quest Board)
   ============================================================ */
.guild-master-area {
  max-width: 700px;
  margin: 0 auto;
  padding: 1.5rem 2rem 0;
  text-align: left;
}
.gm-speech {
  position: relative;
  background: rgba(26, 26, 58, 0.5);
  border: 1px solid var(--border-glow);
  border-left: 3px solid var(--neon-gold);
  padding: 1.2rem 1.5rem;
  margin-bottom: 0.5rem;
}
.gm-label {
  font-family: var(--pixel-font);
  font-size: 0.6rem;
  color: var(--neon-gold);
  text-shadow: 0 0 6px var(--neon-gold-dim);
  margin-bottom: 0.6rem;
  letter-spacing: 0.15em;
}
.gm-line {
  font-size: 0.95rem;
  color: var(--text-primary);
  line-height: 2;
  font-weight: 300;
}

/* ============================================================
   CARD TAGLINE
   ============================================================ */
.card-tagline {
  font-size: 0.75rem;
  color: var(--text-dim);
  font-style: italic;
  margin-bottom: 0.8rem;
  letter-spacing: 0.04em;
  line-height: 1.6;
}

/* ============================================================
   CARD PIXEL FRAME (RPG window border)
   ============================================================ */
.card-image {
  border: 2px solid var(--border-glow);
  border-bottom: 1px solid var(--border-dim);
  image-rendering: auto;
  position: relative;
}
.card-image::before {
  content: '';
  position: absolute;
  inset: 2px;
  border: 1px solid rgba(0,240,255,0.08);
  z-index: 1;
  pointer-events: none;
}

/* ============================================================
   DIFFICULTY SWORDS (⚔ instead of stars)
   ============================================================ */
.difficulty-swords {
  display: flex;
  gap: 3px;
  font-size: 0.8rem;
  line-height: 1;
}
.difficulty-swords .sword { color: var(--neon-gold); text-shadow: 0 0 4px var(--neon-gold-dim); }
.difficulty-swords .sword.empty { color: var(--border-dim); text-shadow: none; }

/* ============================================================
   PURCHASE AREA — Enhanced frame
   ============================================================ */
.purchase-area {
  position: relative;
}
.purchase-area::before {
  content: '';
  position: absolute;
  top: 8px; left: 8px;
  width: 20px; height: 20px;
  border-top: 2px solid var(--neon-gold);
  border-left: 2px solid var(--neon-gold);
  opacity: 0.4;
  pointer-events: none;
}
.purchase-area::after {
  content: '';
  position: absolute;
  bottom: 8px; right: 8px;
  width: 20px; height: 20px;
  border-bottom: 2px solid var(--neon-gold);
  border-right: 2px solid var(--neon-gold);
  opacity: 0.4;
  pointer-events: none;
}
.purchase-flavor {
  font-size: 0.85rem;
  color: var(--text-secondary);
  font-style: italic;
  margin-bottom: 1rem;
  letter-spacing: 0.04em;
}
.purchase-cmd {
  display: inline-flex;
  align-items: center;
  gap: 0.6rem;
}
.purchase-cmd .cmd-icon {
  font-family: var(--pixel-font);
  font-size: 0.9rem;
  color: var(--neon-gold);
}

/* ============================================================
   GOLD PRICE NOTATION
   ============================================================ */
.gold-price {
  font-family: var(--pixel-font);
  font-size: 0.7rem;
  color: var(--text-dim);
  margin-left: 0.3rem;
}

/* ============================================================
   DETAIL — 依頼書 HEADING
   ============================================================ */
.quest-scroll-header {
  border: 1px solid var(--neon-gold-dim);
  background: rgba(255,215,0,0.03);
  padding: 1rem 1.5rem;
  margin-bottom: 1.5rem;
  text-align: center;
  position: relative;
}
.quest-scroll-header::before {
  content: '';
  position: absolute;
  top: 4px; left: 4px;
  width: 14px; height: 14px;
  border-top: 1px solid var(--neon-gold);
  border-left: 1px solid var(--neon-gold);
  opacity: 0.5;
}
.quest-scroll-header::after {
  content: '';
  position: absolute;
  bottom: 4px; right: 4px;
  width: 14px; height: 14px;
  border-bottom: 1px solid var(--neon-gold);
  border-right: 1px solid var(--neon-gold);
  opacity: 0.5;
}
.quest-scroll-label {
  font-family: var(--pixel-font);
  font-size: 0.65rem;
  color: var(--neon-gold);
  text-shadow: 0 0 6px var(--neon-gold-dim);
  letter-spacing: 0.2em;
  margin-bottom: 0.4rem;
}
.quest-scroll-title {
  font-family: var(--pixel-font);
  font-size: clamp(0.9rem, 2.5vw, 1.1rem);
  color: var(--text-primary);
}

/* ============================================================
   FOOTER WORLD TEXT
   ============================================================ */
.footer-world {
  font-family: var(--pixel-font);
  font-size: 0.6rem;
  color: var(--text-dim);
  letter-spacing: 0.1em;
  margin-top: 0.5rem;
  opacity: 0.7;
}
</style>
</head>
<body>

<!-- Scanline overlay -->
<div class="scanlines"></div>

<!-- Particle canvas -->
<canvas id="particle-canvas"></canvas>

<!-- Transition overlay -->
<div class="transition-overlay" id="transition-overlay">
  <div class="transition-text">ギルド掲示板を開いています...</div>
</div>

<!-- ============================================================
     PAGE 1 — OPENING
     ============================================================ -->
<div class="page active" id="page-opening">
  <!-- corner frames -->
  <div class="corner-frame tl"></div>
  <div class="corner-frame tr"></div>
  <div class="corner-frame bl"></div>
  <div class="corner-frame br"></div>

  <div class="opening-content">
    <div class="logo-mark">
      <svg width="60" height="60" viewBox="0 0 60 60" fill="none">
        <rect x="2" y="2" width="56" height="56" stroke="#00f0ff" stroke-width="1" opacity="0.3"/>
        <rect x="8" y="8" width="44" height="44" stroke="#00f0ff" stroke-width="1" opacity="0.5"/>
        <path d="M30 14 L46 30 L30 46 L14 30 Z" stroke="#00f0ff" stroke-width="1.5" fill="none"/>
        <circle cx="30" cy="30" r="4" fill="#00f0ff" opacity="0.8"/>
        <line x1="30" y1="18" x2="30" y2="26" stroke="#00f0ff" stroke-width="1" opacity="0.6"/>
        <line x1="34" y1="30" x2="42" y2="30" stroke="#00f0ff" stroke-width="1" opacity="0.6"/>
        <line x1="30" y1="34" x2="30" y2="42" stroke="#00f0ff" stroke-width="1" opacity="0.6"/>
        <line x1="18" y1="30" x2="26" y2="30" stroke="#00f0ff" stroke-width="1" opacity="0.6"/>
      </svg>
    </div>
    <div class="logo-sub">— ENTER THE REAL QUEST —</div>
    <div class="logo-main">リアクエ</div>
    <div class="logo-main-en">REAL QUEST</div>
    <div class="divider-sword">
      <span class="line"></span>
      <span class="diamond"></span>
      <span class="line"></span>
    </div>
    <div class="logo-tagline">日常が、<span>クエスト</span>になる</div>
    <div class="narration-area">
      <div class="narration-line">ある日、見知らぬ封書が届いた——</div>
      <div class="narration-line">中には一枚の羊皮紙と、ギルドの紋章</div>
      <div class="narration-line">"冒険者よ、おまえの日常を変える依頼がある"</div>
    </div>
    <button class="btn-start" id="btn-start" onclick="startAdventure()">
      <span class="play-icon">▶</span>
      <span>ギルドに入る</span>
    </button>
  </div>

  <div class="scroll-hint">▼ CLICK TO START ▼</div>
</div>

<!-- ============================================================
     PAGE 2 — QUEST BOARD
     ============================================================ -->
<div class="page" id="page-quest-board">
  <header class="quest-board-header">
    <div class="header-logo" onclick="goToOpening()" title="ギルド入口へ戻る">◆ リアクエ</div>
    <div class="header-nav">
      <button class="audio-toggle" id="audio-toggle" onclick="toggleAudio()">
        <div class="audio-bars">
          <span></span><span></span><span></span><span></span>
        </div>
        BGM
      </button>
    </div>
  </header>

  <div class="board-title-area">
    <div class="board-label">— GUILD QUEST BOARD —</div>
    <h1 class="board-title">冒険者ギルド掲示板</h1>
    <p class="board-subtitle">依頼書を手に取り、冒険を始めよ。</p>
    <div class="board-divider"></div>
  </div>

  <div class="guild-master-area">
    <div class="gm-speech">
      <div class="gm-label">◆ ギルドマスター</div>
      <div class="gm-line">よく来たな、冒険者。ここは"リアクエ"——現実世界のクエストを管理するギルドだ。</div>
      <div class="gm-line">気になる依頼書を手に取ってみろ。届くのは本物のアイテムと、おまえだけの物語だ。</div>
    </div>
  </div>

  <div class="filter-bar">
    <button class="filter-chip active" onclick="filterQuests('all', this)">すべての依頼</button>
    <button class="filter-chip" onclick="filterQuests('beginner', this)">見習い向け</button>
    <button class="filter-chip" onclick="filterQuests('advanced', this)">熟練者向け</button>
    <button class="filter-chip" onclick="filterQuests('new', this)">新着依頼</button>
  </div>

  <div class="quest-grid" id="quest-grid">
    <!-- Cards rendered by JS -->
  </div>

  <footer class="site-footer">
    <div class="footer-logo">◆ REAL QUEST ◆</div>
    <div class="footer-text">© 2025 リアクエ</div>
    <div class="footer-world">冒険者ギルド"リアクエ" — 日常が、クエストになる</div>
  </footer>
</div>

<!-- ============================================================
     PAGE 3 — QUEST DETAIL
     ============================================================ -->
<div class="page" id="page-detail">
  <header class="quest-board-header">
    <div class="header-logo" onclick="goToOpening()" title="ギルド入口へ戻る">◆ リアクエ</div>
    <div class="header-nav">
      <button class="audio-toggle" id="audio-toggle-detail" onclick="toggleAudio()">
        <div class="audio-bars">
          <span></span><span></span><span></span><span></span>
        </div>
        BGM
      </button>
    </div>
  </header>

  <div class="detail-container" id="detail-content">
    <!-- Rendered by JS -->
  </div>
</div>

<script>
/* ============================================================
   DATA — Quest products
   ============================================================ */
// SVG scene generators for each quest
const questImages = {
  1: (w,h) => `<svg viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <radialGradient id="g1a" cx="50%" cy="60%"><stop offset="0%" stop-color="#1a0a2e"/><stop offset="100%" stop-color="#050508"/></radialGradient>
      <filter id="f1g"><feGaussianBlur stdDeviation="2"/></filter>
    </defs>
    <rect width="${w}" height="${h}" fill="url(#g1a)"/>
    <!-- Shelves -->
    <rect x="20" y="${h*0.55}" width="${w-40}" height="3" fill="#2a1a4a" rx="1"/>
    <rect x="30" y="${h*0.72}" width="${w-60}" height="3" fill="#2a1a4a" rx="1"/>
    <!-- Bottles/flasks -->
    <g opacity="0.8">
      <path d="M${w*0.2} ${h*0.55} L${w*0.2-6} ${h*0.38} Q${w*0.2} ${h*0.32} ${w*0.2+6} ${h*0.38} Z" fill="#00ff8840" stroke="#00ff88" stroke-width="0.5"/>
      <path d="M${w*0.35} ${h*0.55} L${w*0.35-8} ${h*0.35} L${w*0.35-4} ${h*0.28} L${w*0.35+4} ${h*0.28} L${w*0.35+8} ${h*0.35} Z" fill="#ff00aa30" stroke="#ff00aa" stroke-width="0.5"/>
      <circle cx="${w*0.5}" cy="${h*0.42}" r="10" fill="#ffd70020" stroke="#ffd700" stroke-width="0.5"/>
      <rect x="${w*0.5-2}" y="${h*0.32}" width="4" height="10" fill="#ffd70030" stroke="#ffd700" stroke-width="0.5"/>
      <path d="M${w*0.65} ${h*0.55} L${w*0.65-5} ${h*0.4} Q${w*0.65} ${h*0.33} ${w*0.65+5} ${h*0.4} Z" fill="#00f0ff30" stroke="#00f0ff" stroke-width="0.5"/>
      <path d="M${w*0.8} ${h*0.55} L${w*0.8-7} ${h*0.36} L${w*0.8+7} ${h*0.36} Z" fill="#aa66ff20" stroke="#aa66ff" stroke-width="0.5"/>
    </g>
    <!-- Scroll on lower shelf -->
    <ellipse cx="${w*0.4}" cy="${h*0.72}" rx="14" ry="5" fill="#3a2a1a" stroke="#ffd70040" stroke-width="0.5"/>
    <rect x="${w*0.38}" y="${h*0.65}" width="8" height="7" rx="4" fill="#4a3a2a" stroke="#ffd70040" stroke-width="0.5"/>
    <!-- Key glow -->
    <circle cx="${w*0.65}" cy="${h*0.68}" r="3" fill="#ffd700" filter="url(#f1g)" opacity="0.6"/>
    <path d="M${w*0.65} ${h*0.66} l3-4 m-3 4 l-3-4 m3 4 l0 5 l2 1 m-2-1 l-2 1" stroke="#ffd700" stroke-width="0.8" fill="none"/>
    <!-- Magical particles -->
    <circle cx="${w*0.3}" cy="${h*0.25}" r="1" fill="#ffd700" opacity="0.8"><animate attributeName="opacity" values="0.8;0.2;0.8" dur="2s" repeatCount="indefinite"/></circle>
    <circle cx="${w*0.7}" cy="${h*0.2}" r="1.5" fill="#00f0ff" opacity="0.6"><animate attributeName="opacity" values="0.6;0.1;0.6" dur="3s" repeatCount="indefinite"/></circle>
    <circle cx="${w*0.55}" cy="${h*0.15}" r="1" fill="#ff00aa" opacity="0.5"><animate attributeName="opacity" values="0.5;0.1;0.5" dur="2.5s" repeatCount="indefinite"/></circle>
    <circle cx="${w*0.15}" cy="${h*0.4}" r="0.8" fill="#ffd700" opacity="0.7"><animate attributeName="opacity" values="0.7;0.2;0.7" dur="1.8s" repeatCount="indefinite"/></circle>
  </svg>`,

  2: (w,h) => `<svg viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <radialGradient id="g2a" cx="50%" cy="30%"><stop offset="0%" stop-color="#0a0a2a"/><stop offset="100%" stop-color="#050508"/></radialGradient>
      <filter id="f2g"><feGaussianBlur stdDeviation="3"/></filter>
    </defs>
    <rect width="${w}" height="${h}" fill="url(#g2a)"/>
    <!-- Moon -->
    <circle cx="${w*0.75}" cy="${h*0.2}" r="18" fill="#e8e6f0" opacity="0.15" filter="url(#f2g)"/>
    <circle cx="${w*0.75}" cy="${h*0.2}" r="10" fill="#c8c6e0" opacity="0.3"/>
    <circle cx="${w*0.77}" cy="${h*0.18}" r="10" fill="#0a0a2a" opacity="0.7"/>
    <!-- Bookshelves -->
    <g opacity="0.7">
      <rect x="${w*0.05}" y="${h*0.3}" width="${w*0.25}" height="${h*0.65}" fill="#0d0820" stroke="#1a1a3a" stroke-width="0.5"/>
      <rect x="${w*0.7}" y="${h*0.25}" width="${w*0.25}" height="${h*0.7}" fill="#0d0820" stroke="#1a1a3a" stroke-width="0.5"/>
      ${[0.35,0.5,0.65,0.8].map(y => `<rect x="${w*0.07}" y="${h*y}" width="${w*0.21}" height="2" fill="#1a1a3a"/>`).join('')}
      ${[0.3,0.45,0.6,0.75].map(y => `<rect x="${w*0.72}" y="${h*y}" width="${w*0.21}" height="2" fill="#1a1a3a"/>`).join('')}
    </g>
    <!-- Book spines on shelves -->
    <g opacity="0.6">
      ${[0,1,2,3,4].map(i => `<rect x="${w*0.08+i*10}" y="${h*0.37}" width="7" height="12" fill="hsl(${260+i*30},40%,20%)" stroke="hsl(${260+i*30},60%,40%)" stroke-width="0.3" rx="0.5"/>`).join('')}
      ${[0,1,2,3].map(i => `<rect x="${w*0.73+i*12}" y="${h*0.32}" width="9" height="12" fill="hsl(${200+i*40},40%,18%)" stroke="hsl(${200+i*40},60%,35%)" stroke-width="0.3" rx="0.5"/>`).join('')}
    </g>
    <!-- Open glowing book center -->
    <g transform="translate(${w*0.5},${h*0.6})">
      <path d="M-20 0 Q-15 -8 0 -10 Q15 -8 20 0 Z" fill="#1a0a30" stroke="#aa66ff" stroke-width="0.5"/>
      <path d="M0 -10 L0 0" stroke="#aa66ff40" stroke-width="0.3"/>
      <circle cx="0" cy="-5" r="12" fill="#aa66ff" opacity="0.1" filter="url(#f2g)"/>
      <circle cx="0" cy="-5" r="6" fill="#aa66ff" opacity="0.15" filter="url(#f2g)"/>
    </g>
    <!-- Floating glyphs -->
    <text x="${w*0.4}" y="${h*0.42}" font-size="6" fill="#aa66ff" opacity="0.4" font-family="serif">✦</text>
    <text x="${w*0.55}" y="${h*0.38}" font-size="5" fill="#aa66ff" opacity="0.3" font-family="serif">✧</text>
    <text x="${w*0.45}" y="${h*0.48}" font-size="4" fill="#aa66ff" opacity="0.35" font-family="serif">⍟</text>
    <circle cx="${w*0.42}" cy="${h*0.35}" r="1" fill="#aa66ff" opacity="0.6"><animate attributeName="cy" values="${h*0.35};${h*0.3};${h*0.35}" dur="3s" repeatCount="indefinite"/></circle>
    <circle cx="${w*0.58}" cy="${h*0.32}" r="0.8" fill="#aa66ff" opacity="0.5"><animate attributeName="cy" values="${h*0.32};${h*0.27};${h*0.32}" dur="2.5s" repeatCount="indefinite"/></circle>
  </svg>`,

  3: (w,h) => `<svg viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="g3a" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#1a1008"/><stop offset="100%" stop-color="#050508"/></linearGradient>
      <filter id="f3g"><feGaussianBlur stdDeviation="2.5"/></filter>
    </defs>
    <rect width="${w}" height="${h}" fill="url(#g3a)"/>
    <!-- Desert dunes -->
    <path d="M0 ${h*0.7} Q${w*0.2} ${h*0.55} ${w*0.4} ${h*0.65} Q${w*0.6} ${h*0.75} ${w*0.8} ${h*0.6} Q${w*0.9} ${h*0.55} ${w} ${h*0.62} L${w} ${h} L0 ${h} Z" fill="#1a1508" stroke="#3a2a08" stroke-width="0.5"/>
    <!-- Ruins/pillars -->
    <rect x="${w*0.25}" y="${h*0.3}" width="8" height="${h*0.4}" fill="#1a1a10" stroke="#ffd70020" stroke-width="0.5"/>
    <rect x="${w*0.25-3}" y="${h*0.28}" width="14" height="5" fill="#1a1a10" stroke="#ffd70020" stroke-width="0.5"/>
    <rect x="${w*0.65}" y="${h*0.35}" width="8" height="${h*0.3}" fill="#1a1a10" stroke="#ffd70020" stroke-width="0.5"/>
    <rect x="${w*0.65-3}" y="${h*0.33}" width="14" height="5" fill="#1a1a10" stroke="#ffd70020" stroke-width="0.5"/>
    <!-- Broken arch -->
    <path d="M${w*0.29} ${h*0.3} Q${w*0.45} ${h*0.15} ${w*0.61} ${h*0.35}" stroke="#ffd70015" stroke-width="2" fill="none" stroke-dasharray="4 3"/>
    <!-- Stone tablet center -->
    <g transform="translate(${w*0.5},${h*0.52})">
      <rect x="-15" y="-20" width="30" height="28" rx="2" fill="#2a2010" stroke="#ffd700" stroke-width="0.5" opacity="0.6"/>
      <line x1="-10" y1="-14" x2="10" y2="-14" stroke="#ffd70050" stroke-width="0.5"/>
      <line x1="-8" y1="-9" x2="8" y2="-9" stroke="#ffd70040" stroke-width="0.5"/>
      <line x1="-10" y1="-4" x2="10" y2="-4" stroke="#ffd70050" stroke-width="0.5"/>
      <line x1="-6" y1="1" x2="6" y2="1" stroke="#ffd70030" stroke-width="0.5"/>
      <circle cx="0" cy="-12" r="8" fill="#ffd700" opacity="0.06" filter="url(#f3g)"/>
    </g>
    <!-- Stars -->
    ${[...Array(8)].map((_,i) => `<circle cx="${w*0.1+Math.random()*w*0.8}" cy="${h*0.05+Math.random()*h*0.25}" r="${0.5+Math.random()}" fill="#ffd700" opacity="${0.2+Math.random()*0.4}"/>`).join('')}
    <!-- Compass glow -->
    <circle cx="${w*0.82}" cy="${h*0.75}" r="8" fill="#ffd700" opacity="0.05" filter="url(#f3g)"/>
    <circle cx="${w*0.82}" cy="${h*0.75}" r="5" stroke="#ffd700" stroke-width="0.5" fill="none" opacity="0.3"/>
    <line x1="${w*0.82}" y1="${h*0.75-4}" x2="${w*0.82}" y2="${h*0.75+4}" stroke="#ffd700" stroke-width="0.3" opacity="0.4"/>
    <line x1="${w*0.82-4}" y1="${h*0.75}" x2="${w*0.82+4}" y2="${h*0.75}" stroke="#ffd700" stroke-width="0.3" opacity="0.4"/>
  </svg>`,

  4: (w,h) => `<svg viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <radialGradient id="g4a" cx="50%" cy="30%"><stop offset="0%" stop-color="#0a0812"/><stop offset="100%" stop-color="#050508"/></radialGradient>
      <filter id="f4g"><feGaussianBlur stdDeviation="3"/></filter>
    </defs>
    <rect width="${w}" height="${h}" fill="url(#g4a)"/>
    <!-- Clock tower silhouette -->
    <g transform="translate(${w*0.5},${h*0.1})">
      <rect x="-18" y="10" width="36" height="${h*0.8}" fill="#0a0812" stroke="#1a1a3a" stroke-width="0.5"/>
      <rect x="-22" y="${h*0.7}" width="44" height="${h*0.2}" fill="#0a0812" stroke="#1a1a3a" stroke-width="0.5"/>
      <polygon points="-14,10 0,-10 14,10" fill="#0a0812" stroke="#1a1a3a" stroke-width="0.5"/>
      <!-- Clock face -->
      <circle cx="0" cy="35" r="14" fill="#0d0d1a" stroke="#00f0ff" stroke-width="0.5" opacity="0.6"/>
      <circle cx="0" cy="35" r="12" fill="none" stroke="#00f0ff" stroke-width="0.3" opacity="0.3"/>
      <!-- Clock hands (stopped) -->
      <line x1="0" y1="35" x2="0" y2="25" stroke="#00f0ff" stroke-width="1" opacity="0.7"/>
      <line x1="0" y1="35" x2="8" y2="32" stroke="#00f0ff" stroke-width="0.7" opacity="0.5"/>
      <circle cx="0" cy="35" r="1.5" fill="#00f0ff" opacity="0.5"/>
      <!-- Hour markers -->
      ${[...Array(12)].map((_,i) => {const a=i*30*Math.PI/180; return `<circle cx="${Math.sin(a)*11}" cy="${35-Math.cos(a)*11}" r="0.6" fill="#00f0ff" opacity="0.4"/>`}).join('')}
      <!-- Windows -->
      <rect x="-6" y="55" width="5" height="8" rx="2.5" fill="#00f0ff08" stroke="#00f0ff20" stroke-width="0.3"/>
      <rect x="1" y="55" width="5" height="8" rx="2.5" fill="#00f0ff08" stroke="#00f0ff20" stroke-width="0.3"/>
    </g>
    <!-- Ghost particles -->
    <circle cx="${w*0.3}" cy="${h*0.4}" r="4" fill="#00f0ff" opacity="0.04" filter="url(#f4g)"><animate attributeName="cy" values="${h*0.4};${h*0.35};${h*0.4}" dur="4s" repeatCount="indefinite"/></circle>
    <circle cx="${w*0.7}" cy="${h*0.5}" r="3" fill="#00f0ff" opacity="0.05" filter="url(#f4g)"><animate attributeName="cy" values="${h*0.5};${h*0.45};${h*0.5}" dur="3s" repeatCount="indefinite"/></circle>
    <!-- Fog -->
    <ellipse cx="${w*0.3}" cy="${h*0.85}" rx="${w*0.3}" ry="15" fill="#0a0812" opacity="0.5" filter="url(#f4g)"/>
    <ellipse cx="${w*0.7}" cy="${h*0.9}" rx="${w*0.25}" ry="12" fill="#0a0812" opacity="0.4" filter="url(#f4g)"/>
  </svg>`,

  5: (w,h) => `<svg viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="g5a" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#020818"/><stop offset="100%" stop-color="#050508"/></linearGradient>
      <filter id="f5g"><feGaussianBlur stdDeviation="3"/></filter>
    </defs>
    <rect width="${w}" height="${h}" fill="url(#g5a)"/>
    <!-- Water caustics -->
    <g opacity="0.15">
      ${[...Array(6)].map((_,i) => `<ellipse cx="${w*0.15+i*w*0.14}" cy="${h*0.2+Math.sin(i)*h*0.1}" rx="${15+i*3}" ry="${8+i*2}" fill="none" stroke="#00f0ff" stroke-width="0.5"><animate attributeName="rx" values="${15+i*3};${20+i*3};${15+i*3}" dur="${3+i*0.5}s" repeatCount="indefinite"/></ellipse>`).join('')}
    </g>
    <!-- Underwater ruins -->
    <g transform="translate(${w*0.5},${h*0.55})" opacity="0.7">
      <!-- Temple structure -->
      <rect x="-30" y="-5" width="60" height="35" fill="#0a1020" stroke="#00f0ff30" stroke-width="0.5"/>
      <polygon points="-35,-5 0,-22 35,-5" fill="#0a1020" stroke="#00f0ff30" stroke-width="0.5"/>
      <!-- Doorway -->
      <rect x="-8" y="8" width="16" height="22" rx="8" fill="#00f0ff08" stroke="#00f0ff" stroke-width="0.3" opacity="0.4"/>
      <!-- Columns -->
      <rect x="-25" y="-2" width="4" height="32" fill="#0a1020" stroke="#00f0ff20" stroke-width="0.3"/>
      <rect x="21" y="-2" width="4" height="32" fill="#0a1020" stroke="#00f0ff20" stroke-width="0.3"/>
      <!-- Crystal glow from door -->
      <circle cx="0" cy="18" r="15" fill="#00f0ff" opacity="0.06" filter="url(#f5g)"/>
    </g>
    <!-- Bubbles -->
    ${[...Array(10)].map((_,i) => `<circle cx="${w*0.1+Math.random()*w*0.8}" cy="${h*0.3+Math.random()*h*0.6}" r="${1+Math.random()*2}" fill="none" stroke="#00f0ff" stroke-width="0.3" opacity="${0.15+Math.random()*0.25}"><animate attributeName="cy" values="${h*0.3+Math.random()*h*0.6};${h*0.1};${h*0.3+Math.random()*h*0.6}" dur="${4+Math.random()*4}s" repeatCount="indefinite"/></circle>`).join('')}
    <!-- Crystal -->
    <g transform="translate(${w*0.2},${h*0.7})">
      <polygon points="0,-10 6,0 0,10 -6,0" fill="#00f0ff15" stroke="#00f0ff" stroke-width="0.5" opacity="0.5"/>
      <circle cx="0" cy="0" r="8" fill="#00f0ff" opacity="0.05" filter="url(#f5g)"/>
    </g>
  </svg>`,

  6: (w,h) => `<svg viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <radialGradient id="g6a" cx="40%" cy="50%"><stop offset="0%" stop-color="#1a0a18"/><stop offset="100%" stop-color="#050508"/></radialGradient>
      <filter id="f6g"><feGaussianBlur stdDeviation="2"/></filter>
    </defs>
    <rect width="${w}" height="${h}" fill="url(#g6a)"/>
    <!-- Shop shelf -->
    <rect x="${w*0.1}" y="${h*0.45}" width="${w*0.8}" height="3" fill="#2a1a2a" rx="1"/>
    <rect x="${w*0.08}" y="${h*0.75}" width="${w*0.84}" height="3" fill="#2a1a2a" rx="1"/>
    <!-- Potion bottles -->
    <g opacity="0.8">
      <path d="M${w*0.2} ${h*0.45} L${w*0.2-5} ${h*0.32} Q${w*0.2} ${h*0.26} ${w*0.2+5} ${h*0.32} Z" fill="#ff00aa25" stroke="#ff00aa" stroke-width="0.5"/>
      <rect x="${w*0.2-2}" y="${h*0.24}" width="4" height="5" rx="1" fill="#ff00aa15" stroke="#ff00aa" stroke-width="0.3"/>
      <path d="M${w*0.35} ${h*0.45} L${w*0.35-7} ${h*0.3} L${w*0.35+7} ${h*0.3} Z" fill="#00ff8820" stroke="#00ff88" stroke-width="0.5"/>
      <rect x="${w*0.35-2}" y="${h*0.24}" width="4" height="6" rx="1" fill="#00ff8815" stroke="#00ff88" stroke-width="0.3"/>
      <circle cx="${w*0.52}" cy="${h*0.36}" r="8" fill="#ffd70015" stroke="#ffd700" stroke-width="0.5"/>
      <rect x="${w*0.52-2}" y="${h*0.26}" width="4" height="5" rx="1" fill="#ffd70020" stroke="#ffd700" stroke-width="0.3"/>
      <path d="M${w*0.68} ${h*0.45} L${w*0.68-4} ${h*0.33} Q${w*0.68} ${h*0.28} ${w*0.68+4} ${h*0.33} Z" fill="#00f0ff20" stroke="#00f0ff" stroke-width="0.5"/>
      <path d="M${w*0.82} ${h*0.45} L${w*0.82-6} ${h*0.34} L${w*0.82-3} ${h*0.27} L${w*0.82+3} ${h*0.27} L${w*0.82+6} ${h*0.34} Z" fill="#aa66ff20" stroke="#aa66ff" stroke-width="0.5"/>
    </g>
    <!-- Herbs on lower shelf -->
    <g opacity="0.6">
      ${[0.18,0.32,0.48,0.62,0.78].map((x,i) => `<g transform="translate(${w*x},${h*0.7})"><line x1="0" y1="0" x2="0" y2="-8" stroke="#00ff88" stroke-width="0.5"/><circle cx="${-2}" cy="${-9}" r="2" fill="#00ff8830"/><circle cx="${2}" cy="${-10}" r="1.5" fill="#00ff8820"/><circle cx="${0}" cy="${-7}" r="1.8" fill="#00ff8825"/></g>`).join('')}
    </g>
    <!-- Warm candle glow -->
    <circle cx="${w*0.5}" cy="${h*0.5}" r="30" fill="#ffd700" opacity="0.04" filter="url(#f6g)"/>
    <circle cx="${w*0.5}" cy="${h*0.5}" r="15" fill="#ffd700" opacity="0.06" filter="url(#f6g)"/>
    <!-- Sparkles -->
    <circle cx="${w*0.3}" cy="${h*0.2}" r="1" fill="#ff00aa" opacity="0.5"><animate attributeName="opacity" values="0.5;0.1;0.5" dur="2s" repeatCount="indefinite"/></circle>
    <circle cx="${w*0.6}" cy="${h*0.18}" r="0.8" fill="#00ff88" opacity="0.4"><animate attributeName="opacity" values="0.4;0.1;0.4" dur="2.8s" repeatCount="indefinite"/></circle>
    <circle cx="${w*0.75}" cy="${h*0.25}" r="1.2" fill="#ffd700" opacity="0.5"><animate attributeName="opacity" values="0.5;0.15;0.5" dur="1.8s" repeatCount="indefinite"/></circle>
  </svg>`,
};

function getQuestImage(id, w, h) {
  return questImages[id] ? questImages[id](w, h) : '';
}

const quests = [
  {
    id: 1,
    title: '消えた錬金術師の遺産',
    tagline: '失われた知識が、あなたの手元に届く——',
    rank: 'A',
    difficulty: 3,
    price: 4980,
    category: 'advanced',
    isNew: true,
    estimatedTime: '3〜5時間',
    players: '1〜4人',
    genre: '謎解き × ファンタジー',
    items: [
      { icon: '📜', name: '錬金術師の手記（暗号入り羊皮紙風）' },
      { icon: '🧪', name: '謎の試薬セット（3本）' },
      { icon: '🗝️', name: '封印の鍵（金属製レプリカ）' },
      { icon: '📦', name: 'ギルドからの依頼書' },
    ],
    prologue: 'かつて王国に仕えた天才錬金術師・エルドが姿を消してから百年。彼の工房跡から届いた一通の手紙には、「遺産を継ぐ者へ」とだけ記されていた。封を開けた瞬間、あなたの日常は冒険へと変わる。手記に隠された暗号を解き、失われた錬金術の秘密に辿り着けるか——。',
  },
  {
    id: 2,
    title: '月夜の図書館と禁断の書',
    tagline: 'ページを開くと、現実が書き換わる——',
    rank: 'B',
    difficulty: 2,
    price: 3480,
    category: 'beginner',
    isNew: false,
    estimatedTime: '2〜3時間',
    players: '1〜2人',
    genre: '謎解き × ホラー',
    items: [
      { icon: '📖', name: '禁断の書（特殊インク仕掛け本）' },
      { icon: '🕯️', name: '蝋封の手紙' },
      { icon: '🔮', name: '月光石（蓄光アクセサリー）' },
    ],
    prologue: '深夜の図書館で見つけた一冊の古書。表紙には「この本を読んだ者は、物語の中に取り込まれる」と警告が刻まれている。好奇心に負けてページをめくったその瞬間——図書館の照明が消え、物語が動き出す。',
  },
  {
    id: 3,
    title: '失われた王国の暗号',
    tagline: '千年の謎が、今あなたの元に——',
    rank: 'A',
    difficulty: 4,
    price: 5980,
    category: 'advanced',
    isNew: true,
    estimatedTime: '5〜8時間',
    players: '1〜4人',
    genre: '暗号解読 × 歴史冒険',
    items: [
      { icon: '🗺️', name: '古代王国の地図（布製）' },
      { icon: '💎', name: '王家の紋章（メタルコイン）' },
      { icon: '📜', name: '暗号文書セット（5枚）' },
      { icon: '🧭', name: '冒険者のコンパス（機能付き）' },
      { icon: '📦', name: 'ギルド特別依頼書' },
    ],
    prologue: '学術調査隊が砂漠の遺跡で発見した石板の拓本が、冒険者ギルド経由であなたに届いた。石板には滅びた王国の財宝の在処が記されているという。だが暗号は幾重にも重ねられ、解読には王国の歴史そのものを紐解く必要がある。',
  },
  {
    id: 4,
    title: '時計塔の幽霊事件簿',
    tagline: '時を止めた真犯人を、暴け——',
    rank: 'B',
    difficulty: 2,
    price: 3980,
    category: 'beginner',
    isNew: false,
    estimatedTime: '2〜4時間',
    players: '1〜3人',
    genre: '推理 × ゴシック',
    items: [
      { icon: '🕰️', name: '止まった懐中時計（レプリカ）' },
      { icon: '📋', name: '事件調書ファイル' },
      { icon: '🔍', name: '探偵の証拠品セット' },
    ],
    prologue: '街の象徴である時計塔が、ある夜を境に止まった。同時に塔守が姿を消し、「幽霊の仕業だ」と噂が広まる。ギルドから届いた事件調書には、不可解な証言と矛盾する証拠が並ぶ。真相は、止まった時計の針の先にある。',
  },
  {
    id: 5,
    title: '深海遺跡からの招待状',
    tagline: '海底に眠る文明が、あなたを呼んでいる——',
    rank: 'S',
    difficulty: 5,
    price: 7980,
    category: 'advanced',
    isNew: true,
    estimatedTime: '6〜10時間',
    players: '2〜5人',
    genre: '謎解き × SF × アドベンチャー',
    items: [
      { icon: '🐚', name: '深海の通信器（音声ギミック付き）' },
      { icon: '🗺️', name: '海底遺跡の海図（防水仕様）' },
      { icon: '💠', name: '古代文明のクリスタル（LED内蔵）' },
      { icon: '📜', name: '暗号化された研究日誌' },
      { icon: '🧩', name: 'パズルロックボックス' },
      { icon: '📦', name: 'ギルド最高機密依頼書' },
    ],
    prologue: '深海探査船が海底3,000mで発見した遺跡——それは、既知のどの文明にも属さない未知の建造物だった。探査チームが回収した遺物の一つ「通信器」が突如起動し、あなたの名前を呼んだ。海底からの招待に応じる覚悟はあるか。',
  },
  {
    id: 6,
    title: '魔法薬店の最後の一日',
    tagline: '閉店までに、最後のレシピを完成させよ——',
    rank: 'C',
    difficulty: 1,
    price: 2980,
    category: 'beginner',
    isNew: false,
    estimatedTime: '1〜2時間',
    players: '1人',
    genre: '体験型 × ファンタジー',
    items: [
      { icon: '🧪', name: '魔法薬レシピカード（5枚）' },
      { icon: '🌿', name: 'ハーブ素材セット（本物のドライハーブ）' },
      { icon: '📔', name: '薬店主の日記' },
    ],
    prologue: 'ひっそりと営業を続けてきた「月影の魔法薬店」が、今日で閉店する。店主のおばあさんから届いた小包には、完成させられなかった最後のレシピと、本物のハーブが入っていた。「あなたなら、きっと作れるはず」——その言葉を信じて、最後の魔法薬を調合せよ。',
  },
];

/* ============================================================
   STATE
   ============================================================ */
let currentPage = 'opening';
let audioContext = null;
let isPlaying = false;
let bgmNodes = {};

/* ============================================================
   NAVIGATION
   ============================================================ */
function showPage(pageId) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  const target = document.getElementById(pageId);
  if (target) {
    target.classList.add('active');
    target.scrollTop = 0;
  }
}

function playStartSFX() {
  try {
    const sfxCtx = audioContext || new (window.AudioContext || window.webkitAudioContext)();
    const now = sfxCtx.currentTime;
    const sfxGain = sfxCtx.createGain();
    sfxGain.gain.value = 0.15;
    sfxGain.connect(sfxCtx.destination);

    // RPG "quest accepted" ascending arpeggio
    const sfxNotes = [523.25, 659.25, 783.99, 1046.50, 1318.51]; // C5 E5 G5 C6 E6
    sfxNotes.forEach((freq, i) => {
      const osc = sfxCtx.createOscillator();
      const env = sfxCtx.createGain();
      osc.type = 'square';
      osc.frequency.value = freq;
      env.gain.setValueAtTime(0.5, now + i * 0.08);
      env.gain.exponentialRampToValueAtTime(0.01, now + i * 0.08 + 0.25);
      osc.connect(env);
      env.connect(sfxGain);
      osc.start(now + i * 0.08);
      osc.stop(now + i * 0.08 + 0.3);
    });
  } catch(e) {}
}

function startAdventure() {
  const overlay = document.getElementById('transition-overlay');
  overlay.classList.add('active');

  // Play start SFX then BGM
  playStartSFX();
  setTimeout(() => startBGM(), 500);

  setTimeout(() => {
    showPage('page-quest-board');
    currentPage = 'quest-board';
    renderQuestCards(quests);
    setTimeout(() => {
      overlay.classList.remove('active');
    }, 600);
  }, 1500);
}

function goToOpening() {
  showPage('page-opening');
  currentPage = 'opening';
}

function goToQuestBoard() {
  const overlay = document.getElementById('transition-overlay');
  overlay.querySelector('.transition-text').textContent = '掲示板に戻ります...';
  overlay.classList.add('active');
  setTimeout(() => {
    showPage('page-quest-board');
    currentPage = 'quest-board';
    setTimeout(() => {
      overlay.classList.remove('active');
      overlay.querySelector('.transition-text').textContent = 'ギルド掲示板を開いています...';
    }, 400);
  }, 800);
}

function openQuestDetail(questId) {
  const quest = quests.find(q => q.id === questId);
  if (!quest) return;

  const overlay = document.getElementById('transition-overlay');
  overlay.querySelector('.transition-text').textContent = '依頼書を準備中...';
  overlay.classList.add('active');

  setTimeout(() => {
    renderDetail(quest);
    showPage('page-detail');
    currentPage = 'detail';
    setTimeout(() => {
      overlay.classList.remove('active');
      overlay.querySelector('.transition-text').textContent = 'ギルド掲示板を開いています...';
    }, 400);
  }, 800);
}

/* ============================================================
   RENDER — Quest Cards
   ============================================================ */
function renderQuestCards(list) {
  const grid = document.getElementById('quest-grid');
  grid.innerHTML = list.map((q, i) => {
    const rankClass = `rank-${q.rank}`;
    const swords = Array.from({length: 5}, (_, si) =>
      `<span class="sword ${si < q.difficulty ? '' : 'empty'}">⚔</span>`
    ).join('');
    const itemsPreview = q.items.slice(0, 2).map(it => it.name).join('、') + (q.items.length > 2 ? ' 他' : '');

    return `
      <div class="quest-card" style="animation-delay: ${i * 0.1}s" onclick="openQuestDetail(${q.id})" data-category="${q.category}" ${q.isNew ? 'data-new="true"' : ''}>
        ${q.isNew ? '<div class="badge-new">NEW</div>' : ''}
        <div class="card-image">${getQuestImage(q.id, 320, 180)}</div>
        <div class="card-rank ${rankClass}">RANK ${q.rank}</div>
        <div class="card-title">${q.title}</div>
        <div class="card-tagline">${q.tagline}</div>
        <div class="card-meta">
          <div class="meta-row">
            <span class="meta-label">難易度</span>
            <div class="difficulty-swords">${swords}</div>
          </div>
          <div class="meta-row">
            <span class="meta-label">分類</span>
            <span class="meta-value">${q.genre}</span>
          </div>
          <div class="meta-row">
            <span class="meta-label">冒険</span>
            <span class="meta-value">${q.players}／${q.estimatedTime}</span>
          </div>
        </div>
        <div class="card-items">🎁 報酬アイテム：${itemsPreview}</div>
        <div class="card-footer">
          <div class="card-price"><span class="currency">¥</span>${q.price.toLocaleString()}<span class="gold-price">（${q.price.toLocaleString()}G）</span></div>
          <div class="card-action">この依頼を見る →</div>
        </div>
      </div>
    `;
  }).join('');
}

/* ============================================================
   FILTER
   ============================================================ */
function filterQuests(category, btn) {
  document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
  btn.classList.add('active');

  let filtered = quests;
  if (category === 'beginner') filtered = quests.filter(q => q.difficulty <= 2);
  else if (category === 'advanced') filtered = quests.filter(q => q.difficulty >= 3);
  else if (category === 'new') filtered = quests.filter(q => q.isNew);

  renderQuestCards(filtered);
}

/* ============================================================
   RENDER — Detail Page
   ============================================================ */
function renderDetail(quest) {
  const rankClass = `rank-${quest.rank}`;
  const swords = Array.from({length: 5}, (_, i) =>
    `<span class="sword ${i < quest.difficulty ? '' : 'empty'}" style="font-size:0.9rem;">⚔</span>`
  ).join('');

  const container = document.getElementById('detail-content');
  container.innerHTML = `
    <div class="detail-back" onclick="goToQuestBoard()">← 掲示板に戻る</div>
    <div class="detail-hero">${getQuestImage(quest.id, 640, 274)}</div>
    <div class="detail-header">
      <div class="detail-rank-badge ${rankClass}">RANK ${quest.rank} QUEST</div>
      <h1 class="detail-title">${quest.title}</h1>
      <p class="detail-tagline">${quest.tagline}</p>
    </div>

    <div class="quest-scroll-header">
      <div class="quest-scroll-label">— 依頼書 —</div>
      <div class="quest-scroll-title">${quest.title}</div>
    </div>

    <div class="status-panel">
      <div class="status-panel-title">◆ QUEST STATUS</div>
      <div class="status-grid">
        <div class="stat-item">
          <div class="stat-icon">⚔️</div>
          <div class="stat-info">
            <div class="stat-label">クエスト難度</div>
            <div class="stat-value"><span class="difficulty-swords">${swords}</span></div>
          </div>
        </div>
        <div class="stat-item">
          <div class="stat-icon">⏱️</div>
          <div class="stat-info">
            <div class="stat-label">想定所要時間</div>
            <div class="stat-value">${quest.estimatedTime}</div>
          </div>
        </div>
        <div class="stat-item">
          <div class="stat-icon">👥</div>
          <div class="stat-info">
            <div class="stat-label">推奨パーティ人数</div>
            <div class="stat-value">${quest.players}</div>
          </div>
        </div>
        <div class="stat-item">
          <div class="stat-icon">📂</div>
          <div class="stat-info">
            <div class="stat-label">分類</div>
            <div class="stat-value">${quest.genre}</div>
          </div>
        </div>
      </div>
    </div>

    <div class="section-block">
      <div class="section-title">◆ プロローグ</div>
      <div class="prologue-text">${quest.prologue}</div>
    </div>

    <div class="section-block">
      <div class="section-title">◆ 報酬：自宅に届くリアルアイテム</div>
      <ul class="items-list">
        ${quest.items.map(item => `
          <li>
            <span class="item-icon">${item.icon}</span>
            <span>${item.name}</span>
          </li>
        `).join('')}
      </ul>
    </div>

    <div class="purchase-area">
      <div class="purchase-flavor">この依頼を受けると、数日後にリアルアイテムが届く——</div>
      <div class="purchase-price">
        ¥${quest.price.toLocaleString()}<span class="gold-price">（${quest.price.toLocaleString()}G）</span><span class="tax">（税込）</span>
      </div>
      <div class="purchase-shipping">送料無料・ご注文から3〜5日でお届け</div>
      <button class="btn-purchase" onclick="alert('決済ページへ遷移します（デモ）')">
        <span class="cmd-icon">▶</span> このクエストを受注する
      </button>
      <div class="purchase-note">※ 商品の性質上、返品・交換はお受けできません</div>
    </div>

    <footer class="site-footer">
      <div class="footer-logo">◆ REAL QUEST ◆</div>
      <div class="footer-text">© 2025 リアクエ</div>
      <div class="footer-world">冒険者ギルド"リアクエ" — 日常が、クエストになる</div>
    </footer>
  `;
}

/* ============================================================
   WEB AUDIO — IMMERSIVE RPG BGM (Ambient + Chiptune layers)
   ============================================================ */
function startBGM() {
  if (isPlaying) return;

  try {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
  } catch(e) { return; }

  const masterGain = audioContext.createGain();
  masterGain.gain.value = 0;
  masterGain.connect(audioContext.destination);
  masterGain.gain.linearRampToValueAtTime(0.25, audioContext.currentTime + 2);

  const BPM = 110;
  const beatDur = 60 / BPM;
  const sixteenth = beatDur / 4;
  let loopTimerVal = null;

  const nf = (note, octave) => {
    const n = { C:0,'C#':1,D:2,'D#':3,E:4,F:5,'F#':6,G:7,'G#':8,A:9,'A#':10,B:11 };
    return 440 * Math.pow(2, (n[note] - 9 + (octave - 4) * 12) / 12);
  };

  // ================================================================
  // LAYER 1: Ambient pad drone (continuous, immersive atmosphere)
  // ================================================================
  const padGain = audioContext.createGain();
  padGain.gain.value = 0.07;
  const padFilter = audioContext.createBiquadFilter();
  padFilter.type = 'lowpass';
  padFilter.frequency.value = 600;
  padFilter.Q.value = 1.5;
  padGain.connect(padFilter);
  padFilter.connect(masterGain);

  // Slow chord drone: Am → F → C → G
  const padChords = [
    [nf('A',2), nf('C',3), nf('E',3)],
    [nf('F',2), nf('A',2), nf('C',3)],
    [nf('C',3), nf('E',3), nf('G',3)],
    [nf('G',2), nf('B',2), nf('D',3)],
  ];
  let padOscs = [];

  function startPadChord(chordIdx) {
    padOscs.forEach(o => { try { o.osc.stop(); } catch(e){} });
    padOscs = [];
    const chord = padChords[chordIdx % padChords.length];
    const now = audioContext.currentTime;
    chord.forEach((freq, i) => {
      const osc = audioContext.createOscillator();
      const g = audioContext.createGain();
      osc.type = 'sine';
      osc.frequency.value = freq;
      osc.detune.value = (i - 1) * 4;
      g.gain.setValueAtTime(0, now);
      g.gain.linearRampToValueAtTime(0.4, now + 2);
      osc.connect(g);
      g.connect(padGain);
      osc.start();
      padOscs.push({ osc, g });

      // Add detuned copy for thickness
      const osc2 = audioContext.createOscillator();
      const g2 = audioContext.createGain();
      osc2.type = 'sine';
      osc2.frequency.value = freq;
      osc2.detune.value = (i - 1) * 4 + 8;
      g2.gain.setValueAtTime(0, now);
      g2.gain.linearRampToValueAtTime(0.15, now + 2);
      osc2.connect(g2);
      g2.connect(padGain);
      osc2.start();
      padOscs.push({ osc: osc2, g: g2 });
    });
  }

  // LFO modulating pad filter for movement
  const padLfo = audioContext.createOscillator();
  const padLfoGain = audioContext.createGain();
  padLfo.type = 'sine';
  padLfo.frequency.value = 0.15;
  padLfoGain.gain.value = 200;
  padLfo.connect(padLfoGain);
  padLfoGain.connect(padFilter.frequency);
  padLfo.start();

  let padChordIdx = 0;
  startPadChord(0);
  const padInterval = setInterval(() => {
    if (!isPlaying) return;
    padChordIdx++;
    // Fade out old, start new
    const now = audioContext.currentTime;
    padOscs.forEach(o => o.g.gain.linearRampToValueAtTime(0, now + 1.5));
    setTimeout(() => { if (isPlaying) startPadChord(padChordIdx); }, 1200);
  }, beatDur * 16 * 1000); // change chord every 4 bars

  // ================================================================
  // LAYER 2: Chiptune melody (square wave, RPG adventure theme)
  // ================================================================
  const melGain = audioContext.createGain();
  melGain.gain.value = 0.07;
  const melFilter = audioContext.createBiquadFilter();
  melFilter.type = 'lowpass';
  melFilter.frequency.value = 3000;
  melGain.connect(melFilter);
  melFilter.connect(masterGain);

  // [note, octave, duration in sixteenths] 0=rest
  const melody = [
    // 4 bars — Am: mysterious, adventurous
    ['A',4,4], ['C',5,2], ['E',5,2], ['D',5,4], ['C',5,2], ['B',4,2],
    ['A',4,4], ['E',5,4], ['D',5,2], ['C',5,2], ['B',4,2], ['A',4,2],
    // 4 bars — F: wonder
    ['F',4,4], ['A',4,2], ['C',5,2], ['D',5,4], ['C',5,2], ['A',4,2],
    ['F',4,2], ['G',4,2], ['A',4,4], ['G',4,4], [0,0,2], ['F',4,2],
    // 4 bars — C: heroic ascent
    ['C',5,2], ['E',5,2], ['G',5,4], ['A',5,2], ['G',5,2], ['E',5,4],
    ['C',5,2], ['D',5,2], ['E',5,2], ['G',5,2], ['A',5,4], [0,0,4],
    // 4 bars — G: triumphant resolve
    ['G',4,4], ['B',4,2], ['D',5,2], ['E',5,4], ['D',5,2], ['B',4,2],
    ['G',4,2], ['A',4,2], ['B',4,4], ['A',4,4], ['G',4,2], [0,0,2],
  ];

  // ================================================================
  // LAYER 3: Triangle bass
  // ================================================================
  const bassGain = audioContext.createGain();
  bassGain.gain.value = 0.10;
  bassGain.connect(masterGain);

  const bass = [
    // Am
    ['A',2,4], ['E',2,2], ['A',2,2], ['A',2,4], ['C',3,2], ['A',2,2],
    ['A',2,4], ['E',2,4], ['A',2,2], ['E',2,2], ['A',2,2], ['C',3,2],
    // F
    ['F',2,4], ['C',3,2], ['F',2,2], ['F',2,4], ['A',2,2], ['F',2,2],
    ['F',2,4], ['C',3,4], ['A',2,2], ['F',2,2], ['C',3,2], ['F',2,2],
    // C
    ['C',3,4], ['G',2,2], ['C',3,2], ['E',3,4], ['C',3,2], ['G',2,2],
    ['C',3,4], ['E',3,2], ['G',2,2], ['C',3,2], ['E',3,2], ['C',3,2], [0,0,2],
    // G
    ['G',2,4], ['D',3,2], ['G',2,2], ['B',2,4], ['G',2,2], ['D',3,2],
    ['G',2,4], ['B',2,4], ['D',3,2], ['G',2,2], ['B',2,2], [0,0,2],
  ];

  // ================================================================
  // LAYER 4: Drums (soft, rhythmic pulse)
  // ================================================================
  const drumGain = audioContext.createGain();
  drumGain.gain.value = 0.05;
  drumGain.connect(masterGain);

  const drums = 'K00H00SHK00H00SHK00HK0SHK0HK0SSH'.split('');

  // ================================================================
  // LAYER 5: Arpeggio shimmer
  // ================================================================
  const arpGain = audioContext.createGain();
  arpGain.gain.value = 0.03;
  const arpFilter = audioContext.createBiquadFilter();
  arpFilter.type = 'lowpass';
  arpFilter.frequency.value = 2200;
  arpGain.connect(arpFilter);
  arpFilter.connect(masterGain);

  const arpChords = [
    ['A','C','E'], ['A','C','E'], ['A','C','E'], ['A','C','E'],
    ['F','A','C'], ['F','A','C'], ['F','A','C'], ['F','A','C'],
    ['C','E','G'], ['C','E','G'], ['C','E','G'], ['C','E','G'],
    ['G','B','D'], ['G','B','D'], ['G','B','D'], ['G','B','D'],
  ];

  // ================================================================
  // LAYER 6: Ambient reverb tail (shimmer)
  // ================================================================
  const reverbGain = audioContext.createGain();
  reverbGain.gain.value = 0.04;
  reverbGain.connect(masterGain);

  // Simple delay-based pseudo-reverb
  const delay1 = audioContext.createDelay(1);
  delay1.delayTime.value = 0.3;
  const delay1fb = audioContext.createGain();
  delay1fb.gain.value = 0.3;
  const delay2 = audioContext.createDelay(1);
  delay2.delayTime.value = 0.5;
  const delay2fb = audioContext.createGain();
  delay2fb.gain.value = 0.2;
  melFilter.connect(delay1);
  delay1.connect(delay1fb);
  delay1fb.connect(delay1);
  delay1.connect(reverbGain);
  melFilter.connect(delay2);
  delay2.connect(delay2fb);
  delay2fb.connect(delay2);
  delay2.connect(reverbGain);

  // ================================================================
  // Playback helpers
  // ================================================================
  function playNote(type, freq, dur, gn, vol, t) {
    if (!audioContext) return;
    const osc = audioContext.createOscillator();
    const env = audioContext.createGain();
    osc.type = type;
    osc.frequency.value = freq;
    env.gain.setValueAtTime(vol, t);
    env.gain.setValueAtTime(vol * 0.7, t + dur * 0.15);
    env.gain.exponentialRampToValueAtTime(0.001, t + dur * 0.92);
    osc.connect(env);
    env.connect(gn);
    osc.start(t);
    osc.stop(t + dur);
  }

  function playDrumHit(type, t) {
    if (!audioContext) return;
    if (type === 'K') {
      const o = audioContext.createOscillator();
      const g = audioContext.createGain();
      o.type = 'sine';
      o.frequency.setValueAtTime(120, t);
      o.frequency.exponentialRampToValueAtTime(35, t + 0.12);
      g.gain.setValueAtTime(0.5, t);
      g.gain.exponentialRampToValueAtTime(0.001, t + 0.15);
      o.connect(g); g.connect(drumGain);
      o.start(t); o.stop(t + 0.15);
    } else if (type === 'S') {
      const buf = audioContext.createBuffer(1, audioContext.sampleRate * 0.06, audioContext.sampleRate);
      const d = buf.getChannelData(0);
      for (let i = 0; i < d.length; i++) d[i] = Math.random() * 2 - 1;
      const n = audioContext.createBufferSource(); n.buffer = buf;
      const g = audioContext.createGain();
      const f = audioContext.createBiquadFilter();
      f.type = 'highpass'; f.frequency.value = 4000;
      g.gain.setValueAtTime(0.35, t);
      g.gain.exponentialRampToValueAtTime(0.001, t + 0.06);
      n.connect(f); f.connect(g); g.connect(drumGain);
      n.start(t); n.stop(t + 0.06);
    } else if (type === 'H') {
      const buf = audioContext.createBuffer(1, audioContext.sampleRate * 0.03, audioContext.sampleRate);
      const d = buf.getChannelData(0);
      for (let i = 0; i < d.length; i++) d[i] = Math.random() * 2 - 1;
      const n = audioContext.createBufferSource(); n.buffer = buf;
      const g = audioContext.createGain();
      const f = audioContext.createBiquadFilter();
      f.type = 'highpass'; f.frequency.value = 9000;
      g.gain.setValueAtTime(0.15, t);
      g.gain.exponentialRampToValueAtTime(0.001, t + 0.03);
      n.connect(f); f.connect(g); g.connect(drumGain);
      n.start(t); n.stop(t + 0.03);
    }
  }

  // ================================================================
  // Main scheduling loop
  // ================================================================
  function scheduleLoop() {
    if (!isPlaying || !audioContext) return;
    const now = audioContext.currentTime + 0.08;

    // Melody
    let t = now;
    for (const [note, oct, dur] of melody) {
      if (note !== 0) playNote('square', nf(note, oct), dur * sixteenth * 0.88, melGain, 0.45, t);
      t += dur * sixteenth;
    }

    // Bass
    t = now;
    for (const [note, oct, dur] of bass) {
      if (note !== 0) playNote('triangle', nf(note, oct), dur * sixteenth * 0.8, bassGain, 0.55, t);
      t += dur * sixteenth;
    }

    // Total duration from melody
    const totalSx = melody.reduce((s, n) => s + n[2], 0);

    // Drums
    for (let i = 0; i < totalSx; i++) {
      const ch = drums[i % drums.length];
      if (ch !== '0') playDrumHit(ch, now + i * sixteenth);
    }

    // Arpeggios (every other sixteenth)
    for (let i = 0; i < totalSx; i++) {
      if (i % 3 === 0) {
        const ci = Math.floor(i / 4) % arpChords.length;
        const ni = i % 3;
        const ch = arpChords[ci];
        playNote('square', nf(ch[ni], 5), sixteenth * 0.4, arpGain, 0.25, now + i * sixteenth);
      }
    }

    const loopDur = totalSx * sixteenth;
    loopTimerVal = setTimeout(scheduleLoop, (loopDur - 0.3) * 1000);
  }

  scheduleLoop();

  bgmNodes = { masterGain, padLfo, padInterval, loopTimer: () => loopTimerVal, padOscs: () => padOscs };
  isPlaying = true;
  updateAudioButtons();
}

function stopBGM() {
  if (!isPlaying || !audioContext) return;
  isPlaying = false;

  if (bgmNodes.loopTimer) clearTimeout(bgmNodes.loopTimer());
  if (bgmNodes.padInterval) clearInterval(bgmNodes.padInterval);

  // Fade out pad oscillators
  if (bgmNodes.padOscs) {
    const oscs = bgmNodes.padOscs();
    const now = audioContext.currentTime;
    oscs.forEach(o => { try { o.g.gain.linearRampToValueAtTime(0, now + 0.5); } catch(e){} });
  }
  try { bgmNodes.padLfo.stop(); } catch(e){}

  if (bgmNodes.masterGain) {
    bgmNodes.masterGain.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.8);
  }

  setTimeout(() => {
    if (audioContext && audioContext.state !== 'closed') {
      audioContext.close().catch(() => {});
    }
    audioContext = null;
    bgmNodes = {};
  }, 1000);

  updateAudioButtons();
}

function toggleAudio() {
  if (isPlaying) {
    stopBGM();
  } else {
    startBGM();
  }
}

function updateAudioButtons() {
  document.querySelectorAll('.audio-toggle').forEach(btn => {
    btn.classList.toggle('muted', !isPlaying);
  });
}

/* ============================================================
   PARTICLES
   ============================================================ */
(function initParticles() {
  const canvas = document.getElementById('particle-canvas');
  const ctx = canvas.getContext('2d');
  let particles = [];
  const PARTICLE_COUNT = 50;

  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resize();
  window.addEventListener('resize', resize);

  class Particle {
    constructor() {
      this.reset();
    }
    reset() {
      this.x = Math.random() * canvas.width;
      this.y = Math.random() * canvas.height;
      this.size = Math.random() * 2 + 0.5;
      this.speedY = -(Math.random() * 0.3 + 0.1);
      this.speedX = (Math.random() - 0.5) * 0.2;
      this.opacity = Math.random() * 0.5 + 0.1;
      this.hue = Math.random() > 0.7 ? 51 : 180; // gold or cyan
      this.life = Math.random() * 200 + 100;
      this.maxLife = this.life;
    }
    update() {
      this.x += this.speedX;
      this.y += this.speedY;
      this.life--;
      this.opacity = (this.life / this.maxLife) * 0.4;
      if (this.life <= 0 || this.y < -10) this.reset();
    }
    draw() {
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fillStyle = `hsla(${this.hue}, 100%, 70%, ${this.opacity})`;
      ctx.fill();
    }
  }

  for (let i = 0; i < PARTICLE_COUNT; i++) {
    particles.push(new Particle());
  }

  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach(p => {
      p.update();
      p.draw();
    });
    requestAnimationFrame(animate);
  }
  animate();
})();

/* ============================================================
   KEYBOARD — Enter to start
   ============================================================ */
document.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && currentPage === 'opening') {
    startAdventure();
  }
  if (e.key === 'Escape' && currentPage === 'detail') {
    goToQuestBoard();
  }
});
</script>
</body>
</html>
